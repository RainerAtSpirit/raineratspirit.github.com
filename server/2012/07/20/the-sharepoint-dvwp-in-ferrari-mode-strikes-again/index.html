
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>The SharePoint DVWP in Ferrari mode strikes again</title>
	<meta name="author" content="Rainer Wittmann">
	<link href='/assets/themes/the-program/css/style.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="The SharePoint DVWP in Ferrari mode strikes again" type="application/atom+xml">
	
    <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body>
<div id="logowrap">
    <div class="textlogo"><a href="/" title="Goin' back home">&lt;: &gt;</a></div>
</div>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
                   	<ul>
						<!--<li class="logo"><a href="/">RainerAtSpirit's blog</a></li>-->
						<li class="archive"><a href="/archive.html">archive</a></li>
						<li class="page"><a href="/pages.html">pages</a></li>
						<li class="category"><a href="/categories.html">categories</a></li>
						<li class="tag"><a href="/tags.html">tags</a></li>
                        
                        <li class="search">
                            <form action="/search.html" method="get">
                                <input type="search" placeholder="search Posts..." id="q" name="q"
                                       onkeypress="if(event.keyCode==13) {this.submit();}" class="ng-pristine ng-valid">
                            </form>
                        </li>
                        
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">The SharePoint DVWP in Ferrari mode strikes again</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					<p>In the <a href='/2012/07/15/sharepoint-dvwp-from-workhorse-to-ferrari-in-7-steps/'>last post</a> we dissected the SharePoint DVWP up till the point where it delivered <strong>clean HTML5</strong>. If you remember I call this mode the <strong><code>Ferrari</code></strong>. Now the bad news: For those who like to cut things down to the bare bones, that&#8217;s it. You can&#8217;t dissect the <strong>DVWP</strong> any further.</p>

<p>Now the good news: For those who think that this would be great starting point to build something new, read on. In this post I&#8217;m going to show you my way of driving the <strong><code>Ferrari</code></strong>. Of course this is not the only way, so feel free to do something completely different&#8230; and give me your success stories.</p>

<p>First let&#8217;s ask ourselves some question:</p>

<ol>
<li>What are we going to build?</li>

<li>Which technologies are we going to use?</li>

<li>How to effectively use our <strong><code>Ferrari</code></strong> in that scenario?</li>
</ol>

<p><strong>Answer to Q1:</strong> Let&#8217;s build a new version of the <a href='http://www.metaengine.com/2012/03/SharePoint-menu-web-part-with-Metro-style-using-a-DVWP'>Metro style menu web part</a>, that was initially build by <a href='https://plus.google.com/107337505738738118800/posts'>Peter Collins</a>. Hey Rainer, why would you do that? It&#8217;s already build, isn&#8217;t it? Yeah, you&#8217;re right, but we are going to add some visual effects and some configuration options to the picture, which wasn&#8217;t in the first version. Simply think of our version as V2.0.</p>

<p><strong>Answer to Q2:</strong> A <strong><code>Ferrari</code></strong> needs to be driven in adequate places like the N&#252;rburgring <a href='http://www.nuerburgring.de/'>in Germany</a>, so let&#8217;s try to find a technology stack that can cope with that ideal <code>;-)</code>.</p>

<h3 id='technologies'>Technologies:</h3>

<ol>
<li>Accessing SharePoint data: <a href='http://rainerat.spirit.de/2012/07/15/sharepoint-dvwp-from-workhorse-to-ferrari-in-7-steps/'>DVWP in ferrari mode</a></li>

<li>Providing a modern HTML5/CSS3/JavaScript Framework <a href='http://foundation.zurb.com/'>Zurb Foundation 3</a></li>

<li>Metro styled live tiles by Drew Greenwell <a href='http://drewgreenwell.com/projects/metrojs'>MetroJS</a></li>

<li>Alternative for SergoiUI (the metro font) <a href='http://www.google.com/webfonts#UsePlace:use/Collection:Open+Sans+Condensed'>Open Sans Condensed</a></li>

<li>Metro like icons by IconShock <a href='http://www.iconshock.com/windows8-icons/'>Free Metro Icons</a></li>
</ol>

<p>The reasoning behind each selection is simple: I like them. I know that there are alternatives at each level, but as said earlier it&#8217;s your decision entirely&#8230; when you build your solution. Now without further hesitation lets present two screenshots of the live demo. Thanks to some feedback I got on twitter from <a href='https://twitter.com/sympmarc'>Marc D Anderson</a> the second screenshot shows an optimized version for iPhones.</p>

<p><img alt='Empty ASPX Page' src='/img/2012-07-20-dvwp-result.jpg' /></p>

<p><img alt='Empty ASPX Page' src='/img/2012-07-20-dvwp-iPhone.jpg' /></p>

<p><a href='https://github.com/RainerAtSpirit/ZurbMeetsMetroJS/blob/master/MetroStyle.aspx'>Source</a>, <a href='http://www.spirit.de/demos/metro/Zurb/MetroStyle.aspx'>Live</a></p>

<p>I encourage you to take a look at the live version first to see the live tiles in action. All kudos to Drew Greenwell&#8217;s <a href='http://drewgreenwell.com/projects/metrojs'>MetroJS</a> project.</p>

<p>Now let&#8217;s dive a little deeper into the code by looking at the <a href='https://github.com/RainerAtSpirit/ZurbMeetsMetroJS/blob/master/MetroStyle.aspx'>Source</a>. As you can see it&#8217;s almost the same minimal HTML5 that was introduced last time, enhanced by the files required by <a href='http://foundation.zurb.com/'>Zurb Foundation 3</a> and <a href='http://drewgreenwell.com/projects/metrojs'>MetroJS</a>.</p>

<p>Somewhere in the middle you see this div <code>&lt;div id=&quot;metroTiles&quot;&gt;...&lt;/div&gt;</code>, where the <strong>DVWP</strong> is instantiated. If you are looking very closely, you spot some differences from where we left it last time. This time the web part properties are stripped down to the bare minimum and by using <code>&lt;XslLink&gt;XSLT/ListsAsTiles.xslt&lt;/XslLink&gt;</code> we are allowed to store the XSLT in an external file. As in the Peter Collin&#8217;s version the DataSourceMode is set to <code>ListOfLists</code> in which the server returns information about all lists/libraries of the current site.</p>
<div class='highlight'><pre><code class='html'><span class='lineno'> 1</span>     <span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;metroTiles&quot;</span> <span class='na'>class=</span><span class='s'>&quot;twelve columns tiles&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 2</span>         <span class='c'>&lt;!-- DVWP with DataSourceMode=&quot;ListOfLists&quot; --&gt;</span>
<span class='lineno'> 3</span>         <span class='nt'>&lt;WebPartPages:DataFormWebPart</span> <span class='na'>runat=</span><span class='s'>&quot;server&quot;</span> <span class='na'>AsyncRefresh=</span><span class='s'>&quot;False&quot;</span> <span class='na'>FrameType=</span><span class='s'>&quot;None&quot;</span> <span class='na'>SuppressWebPartChrome=</span><span class='s'>&quot;True&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 4</span>             <span class='nt'>&lt;ParameterBindings&gt;&lt;/ParameterBindings&gt;</span>
<span class='lineno'> 5</span>             <span class='nt'>&lt;DataFields&gt;&lt;/DataFields&gt;</span>
<span class='lineno'> 6</span>             <span class='nt'>&lt;XslLink&gt;</span>XSLT/ListsAsTiles.xslt<span class='nt'>&lt;/XslLink&gt;</span>
<span class='lineno'> 7</span>             <span class='nt'>&lt;Xsl&gt;&lt;/Xsl&gt;</span>
<span class='lineno'> 8</span>             <span class='nt'>&lt;DataSources&gt;</span>
<span class='lineno'> 9</span>                 <span class='nt'>&lt;SharePoint:SPDataSource</span> <span class='na'>runat=</span><span class='s'>&quot;server&quot;</span> <span class='na'>DataSourceMode=</span><span class='s'>&quot;ListOfLists&quot;</span> <span class='na'>SelectCommand=</span><span class='s'>&quot;&quot;</span>
<span class='lineno'>10</span>                                          <span class='na'>ID=</span><span class='s'>&quot;dsLists&quot;</span><span class='nt'>&gt;&lt;/SharePoint:SPDataSource&gt;</span>
<span class='lineno'>11</span>             <span class='nt'>&lt;/DataSources&gt;</span>
<span class='lineno'>12</span>         <span class='nt'>&lt;/WebPartPages:DataFormWebPart&gt;</span>
<span class='lineno'>13</span>         <span class='c'>&lt;!-- DVWP with DataSourceMode=&quot;ListOfLists&quot; --&gt;</span>
<span class='lineno'>14</span>     <span class='nt'>&lt;/div&gt;</span>
</code></pre>
</div>
<p>I&#8217;m not going to talk about the <a href='http://foundation.zurb.com/'>Zurb Foundation 3</a> specific configurations here (sass and compass based), but from my first impression I can say at least so much: &#8221;<strong>It&#8217;s hot! Real hot!</strong>&#8221;. A quantum leap compared to other prominent HTML5 frameworks. Don&#8217;t take my word on it, check it out on your own and let me know what you think.</p>

<p><strong>Answer to Q3:</strong> This one is pretty short: Know your <strong>XSLT</strong>.</p>

<p><strong>Checkpoint:</strong> Up till now you should have a rough understanding how the various pieces of the solution fits together. While it&#8217;s certainly not rocket science it&#8217;s nothing for beginners either. But now we are coming to the heart of the solution. We have to fine tune the <strong><code>Ferrari</code></strong>, so that it can deliver its best performance. You asked for it, so here it is:</p>

<p><em>A word of warning</em>: I don&#8217;t want to waste your time, so there&#8217;s no need to read on, if you most likely never work with XSLT at all.</p>

<h3 id='xslt_deep_dive'>XSLT deep dive</h3>

<p>XSLT might not be everybody&#8217;s darling, but let&#8217;s face it, you can do a lot of smart things in SharePoint with it that otherwise would require either third party tools or custom .Net development.</p>

<p>You have access to the complete XSLT at <a href='https://github
.com/RainerAtSpirit/ZurbMeetsMetroJS/blob/master/XSLT/ListsAsTiles.xslt'>github</a> and I&#8217;m going to provide some background information about the various pieces below. Of course that code only reflects my coding style. If you pick up one or another XSLT trick that you find useful, good. If not, there&#8217;s certainly more than one way to skin a cat, so I&#8217;d glad to hear from you about you&#8217;re tackling things instead.</p>

<p>BTW before you ask: My favorite book ever on that topic is Jenni Tennison&#8217;s <a href='http://www
.amazon.com/XSLT-XPath-Unlimited-Professional-Mindware/dp/0764547763'>XSLT and XPath On the edge</a>.</p>

<p>With that here&#8217;s what makes the <strong><code>Ferrari</code></strong> engine tick. After the usual <code>&lt;xsl:stylesheet ..&gt;</code> declaration we start by defining a <code>$Rows</code> variable. It&#8217;s used to filter out list/libaries that you don&#8217;t want to render e.g. like those with <code>(@__spHidden = &#39;True&#39;</code> and &#8230;</p>
<div class='highlight'><pre><code class='xslt'><span class='lineno'>1</span> <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;Rows&quot;</span> <span class='na'>select=</span><span class='s'>&quot;/dsQueryResponse/Rows/Row[not(@__spHidden = &#39;True&#39;) and not(contains</span>
<span class='lineno'>2</span> <span class='s'>(@__spDefaultViewUrl, &#39;_catalogs&#39;)) and @__spTitle != &#39;ServiceFiles&#39;]&quot;</span><span class='nt'>/&gt;</span>
</code></pre>
</div>
<p>One goal for the solution was to make it configurable. One of the easiest way to accomplish that is by defining a variable and access it via <code>msxsl:node-set($VariableName)</code>. Here I&#8217;m using the <code>global</code> element to store global configuration options and <code>tiles</code> to store configuration options based on the <code>BaseTemplate</code> e.g. Contacts, DocumentLibrary and so on. As you can see there are options for color and icon, which control the visual appearance, but also options like <code>data-mode</code> and <code>data-direction</code> that will be used by <a href='http://drewgreenwell.com/projects/metrojs'>MetroJS</a> to provide the slide and flip animations.</p>

<p>In a fully fledged solution you&#8217;d store those somewhere externally and then bring them in either via <em>Linked Data source</em>, cookies, querystrings etc.</p>
<div class='highlight'><pre><code class='xslt'><span class='lineno'> 1</span> <span class='c'>&lt;!-- configMap allows configuration per BaseTemplate --&gt;</span>
<span class='lineno'> 2</span> <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;configMap&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 3</span>     <span class='nt'>&lt;global&gt;</span>
<span class='lineno'> 4</span>         <span class='nt'>&lt;maxTiles&gt;</span>12<span class='nt'>&lt;/maxTiles&gt;</span>
<span class='lineno'> 5</span>         <span class='nt'>&lt;wideTiles&gt;</span>3<span class='nt'>&lt;/wideTiles&gt;</span>
<span class='lineno'> 6</span>         <span class='nt'>&lt;backTileTitle&gt;</span>Last updated<span class='nt'>&lt;/backTileTitle&gt;</span>
<span class='lineno'> 7</span>     <span class='nt'>&lt;/global&gt;</span>
<span class='lineno'> 8</span>     <span class='nt'>&lt;tiles&gt;</span>
<span class='lineno'> 9</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;Contacts&quot;</span> <span class='na'>color=</span><span class='s'>&quot;lime&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/bomb.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>10</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;DocumentLibrary&quot;</span> <span class='na'>color=</span><span class='s'>&quot;teal&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/file.png&quot;</span> <span class='na'>data-mode=</span><span class='s'>&quot;slide&quot;</span>
<span class='lineno'>11</span>               <span class='na'>data-direction=</span><span class='s'>&quot;vertical&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>12</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;GenericList&quot;</span> <span class='na'>color=</span><span class='s'>&quot;green&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/inventory2.png&quot;</span> <span class='na'>data-mode=</span><span class='s'>&quot;flip&quot;</span>
<span class='lineno'>13</span>               <span class='na'>data-direction=</span><span class='s'>&quot;vertical&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>14</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;Tasks&quot;</span> <span class='na'>color=</span><span class='s'>&quot;red&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/bomb.png&quot;</span> <span class='na'>data-mode=</span><span class='s'>&quot;flip&quot;</span>
<span class='lineno'>15</span>               <span class='na'>data-direction=</span><span class='s'>&quot;horizontal&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>16</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;GanttTasks&quot;</span> <span class='na'>color=</span><span class='s'>&quot;purple&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/hand_thumbsup.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>17</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;IssueTracking&quot;</span> <span class='na'>color=</span><span class='s'>&quot;pink&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/clipboard.png&quot;</span> <span class='na'>data-mode=</span><span class='s'>&quot;slide&quot;</span>
<span class='lineno'>18</span>               <span class='na'>data-direction=</span><span class='s'>&quot;vertical&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>19</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;Links&quot;</span> <span class='na'>color=</span><span class='s'>&quot;lime&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/link.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>20</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;WebPageLibrary&quot;</span> <span class='na'>color=</span><span class='s'>&quot;brown&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/clipboard.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>21</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;Events&quot;</span> <span class='na'>color=</span><span class='s'>&quot;mango&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/clipboard.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>22</span>         <span class='nt'>&lt;item</span> <span class='na'>BaseTemplate=</span><span class='s'>&quot;unknown&quot;</span> <span class='na'>color=</span><span class='s'>&quot;blue&quot;</span> <span class='na'>icon=</span><span class='s'>&quot;images/48/smiley_sad.png&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>23</span>     <span class='nt'>&lt;/tiles&gt;</span>
<span class='lineno'>24</span> <span class='k'>&lt;/xsl:variable&gt;</span>
<span class='lineno'>25</span> 
<span class='lineno'>26</span> <span class='c'>&lt;!-- shortcuts to globalConfig and tilesConfig --&gt;</span>
<span class='lineno'>27</span> <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;globalConfig&quot;</span> <span class='na'>select=</span><span class='s'>&quot;msxsl:node-set($configMap)/global&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>28</span> <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;tilesConfig&quot;</span> <span class='na'>select=</span><span class='s'>&quot;msxsl:node-set($configMap)/tiles&quot;</span><span class='nt'>/&gt;</span>
</code></pre>
</div>
<p>The next variable <code>$itemInList</code> stores a result set that it sorted descending by <code>@__spItemCount</code>. This in combination with <code>$globalConfig/wideTiles</code> will be used to show wide tiles based on the number of items in a given list or library e.g. $wideTiles = 3 would show the 3 lists with the most items as wide tile.</p>

<p><div class='highlight'><pre><code class='xslt'><span class='lineno'>1</span> <span class='c'>&lt;!-- itemsInList sorted by @__spItemCount descending. Used to distinguish between normal and wide tiles  --&gt;</span>
<span class='lineno'>2</span> <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;itemsInList&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>3</span>     <span class='k'>&lt;xsl:for-each</span> <span class='na'>select=</span><span class='s'>&quot;$Rows&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>4</span>         <span class='k'>&lt;xsl:sort</span> <span class='na'>select=</span><span class='s'>&quot;@__spItemCount&quot;</span> <span class='na'>order=</span><span class='s'>&quot;descending&quot;</span> <span class='na'>data-type=</span><span class='s'>&quot;number&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>5</span>         <span class='nt'>&lt;item</span> <span class='na'>id=</span><span class='s'>&quot;{@__spID}&quot;</span> <span class='na'>count=</span><span class='s'>&quot;{@__spItemCount}&quot;</span> <span class='na'>pos=</span><span class='s'>&quot;{position()}&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>6</span>     <span class='k'>&lt;/xsl:for-each&gt;</span>
<span class='lineno'>7</span> <span class='k'>&lt;/xsl:variable&gt;</span>
</code></pre>
</div></p>

<p>The above variables are all globally defined, so they can be accessed throughout the code in every template. Next comes the root template and you can see that the result set is sorted by a <em>heavy</em> <strong>XPath</strong> expression. All we want to do here is having the lists/libraries sorted by the time they were last modified, but unfortunately the system buries the only reliable UTC date somewhere down in the <code>@__spPropertiesXml</code> attribute. I leave it up to you to digest this XPath and figure out what it&#8217;s exactly doing.</p>

<p>By checking <code>&lt;xsl:if test=&quot;position() &amp;lt;= $globalConfig/maxTiles&quot;&gt;</code> before we call the <code>Tile</code> template we restrict the number of rendered tiles to whatever is configured, nothing fancy here.</p>
<div class='highlight'><pre><code class='xslt'><span class='lineno'> 1</span> <span class='k'>&lt;xsl:template</span> <span class='na'>match=</span><span class='s'>&quot;/&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 2</span>     <span class='k'>&lt;xsl:for-each</span> <span class='na'>select=</span><span class='s'>&quot;$Rows&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 3</span>         <span class='c'>&lt;!-- This complex sort criteria is required because __spModified is localized. Using information inside __spPropertiesXml instead --&gt;</span>
<span class='lineno'> 4</span>         <span class='k'>&lt;xsl:sort</span>
<span class='lineno'> 5</span>                 <span class='na'>select=</span><span class='s'>&quot;translate(substring-before(substring-after(@__spPropertiesXml, &#39;Modified=&amp;quot;&#39;), &#39;&amp;quot; LastDeleted&#39;), &#39; :&#39;, &#39;&#39;)&quot;</span>
<span class='lineno'> 6</span>                 <span class='na'>order=</span><span class='s'>&quot;descending&quot;</span> <span class='na'>data-type=</span><span class='s'>&quot;number&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 7</span>         <span class='k'>&lt;xsl:if</span> <span class='na'>test=</span><span class='s'>&quot;position() &amp;lt;= $globalConfig/maxTiles&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 8</span>             <span class='k'>&lt;xsl:call-template</span> <span class='na'>name=</span><span class='s'>&quot;Tile&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 9</span>         <span class='k'>&lt;/xsl:if&gt;</span>
<span class='lineno'>10</span>     <span class='k'>&lt;/xsl:for-each&gt;</span>
<span class='lineno'>11</span> <span class='k'>&lt;/xsl:template&gt;</span>
</code></pre>
</div>
<p>The <code>Tile</code> template is responsible for building up the tile html, but as you can see this is divided into multiple separate templates. I simply follow common sense here that mixing structure and logic will become unmaintainable very soon. So we build up a helper variable <code>$t</code> using the <code>MetaData</code> template (logic), which is passed to the <code>TileTemplate</code> (html). Think of this template as your dispenser: logic -&gt; left, structure -&gt;right.</p>
<div class='highlight'><pre><code class='xslt'><span class='lineno'> 1</span> <span class='k'>&lt;xsl:template</span> <span class='na'>name=</span><span class='s'>&quot;Tile&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 2</span>     <span class='c'>&lt;!-- Mashup of $configMap and $ itemsInList for the current item --&gt;</span>
<span class='lineno'> 3</span>     <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;coreMetaData&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 4</span>         <span class='k'>&lt;xsl:call-template</span> <span class='na'>name=</span><span class='s'>&quot;MetaData&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 5</span>             <span class='k'>&lt;xsl:with-param</span> <span class='na'>name=</span><span class='s'>&quot;baseTemplate&quot;</span> <span class='na'>select=</span><span class='s'>&quot;@__spBaseTemplate&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 6</span>             <span class='k'>&lt;xsl:with-param</span> <span class='na'>name=</span><span class='s'>&quot;spID&quot;</span> <span class='na'>select=</span><span class='s'>&quot;@__spID&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 7</span>             <span class='k'>&lt;xsl:with-param</span> <span class='na'>name=</span><span class='s'>&quot;spPropertiesXml&quot;</span> <span class='na'>select=</span><span class='s'>&quot;@__spPropertiesXml&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 8</span>         <span class='k'>&lt;/xsl:call-template&gt;</span>
<span class='lineno'> 9</span>     <span class='k'>&lt;/xsl:variable&gt;</span>
<span class='lineno'>10</span>     <span class='c'>&lt;!-- shortcut for accessing $coreMetaData --&gt;</span>
<span class='lineno'>11</span>     <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;t&quot;</span> <span class='na'>select=</span><span class='s'>&quot;msxsl:node-set($coreMetaData)&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>12</span> 
<span class='lineno'>13</span>     <span class='k'>&lt;xsl:call-template</span> <span class='na'>name=</span><span class='s'>&quot;TileTemplate&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>14</span>         <span class='k'>&lt;xsl:with-param</span> <span class='na'>name=</span><span class='s'>&quot;t&quot;</span> <span class='na'>select=</span><span class='s'>&quot;$t&quot;</span> <span class='nt'>/&gt;</span>
<span class='lineno'>15</span>     <span class='k'>&lt;/xsl:call-template&gt;</span>
<span class='lineno'>16</span> <span class='k'>&lt;/xsl:template&gt;</span>
</code></pre>
</div>
<p>Alright prime time; we are building the required html that represents one tile. We start by copying the tile html from the <a href='http://drewgreenwell.com/projects/metrojs'>MetroJS</a> page. There are multipe variable that you can access here.</p>

<ol>
<li><code>$Rows</code> attributes can be accessed directly e.g. <code>&lt;xsl:value-of select=&quot;@__spItemCount&quot;/&gt;</code> or <code>data-target=&quot;{@__spDefaultViewUrl}&quot;</code>.</li>

<li>Meta data can be accessed through <code>$t</code> with the same ease as e.g. <code> &lt;div class=&quot;live-tile
{$t/item/@color} {$t/size}&quot;</code> or <code>&lt;img src=&quot;{$t/item/@icon}&quot; class=&quot;micon&quot;/&gt;</code>.</li>

<li>You&#8217;ve access to everything that was globally defined like e.g <code>$globalConfig</code>.</li>
</ol>
<div class='highlight'><pre><code class='xslt'><span class='lineno'> 1</span> <span class='k'>&lt;xsl:template</span> <span class='na'>name=</span><span class='s'>&quot;TileTemplate&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 2</span>     <span class='k'>&lt;xsl:param</span> <span class='na'>name=</span><span class='s'>&quot;t&quot;</span> <span class='nt'>/&gt;</span>
<span class='lineno'> 3</span>     <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;live-tile {$t/item/@color} {$t/size}&quot;</span>
<span class='lineno'> 4</span>          <span class='na'>data-stops=</span><span class='s'>&quot;100%&quot;</span>
<span class='lineno'> 5</span>          <span class='na'>data-speed=</span><span class='s'>&quot;750&quot;</span>
<span class='lineno'> 6</span>          <span class='na'>data-delay=</span><span class='s'>&quot;-1&quot;</span>
<span class='lineno'> 7</span>          <span class='na'>data-mode=</span><span class='s'>&quot;{$t/item/@data-mode}&quot;</span>
<span class='lineno'> 8</span>          <span class='na'>data-direction=</span><span class='s'>&quot;{$t/item/@data-direction}&quot;</span>
<span class='lineno'> 9</span>          <span class='na'>data-target=</span><span class='s'>&quot;{@__spDefaultViewUrl}&quot;</span>
<span class='lineno'>10</span>          <span class='na'>data-baseTemplate=</span><span class='s'>&quot;{@__spBaseTemplate}&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>11</span>         <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;tile-title&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>12</span>             <span class='k'>&lt;xsl:value-of</span> <span class='na'>select=</span><span class='s'>&quot;@__spTitle&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>13</span>             <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;badge right&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>14</span>                 <span class='k'>&lt;xsl:value-of</span> <span class='na'>select=</span><span class='s'>&quot;@__spItemCount&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>15</span>             <span class='nt'>&lt;/span&gt;</span>
<span class='lineno'>16</span>         <span class='nt'>&lt;/span&gt;</span>
<span class='lineno'>17</span>         <span class='nt'>&lt;div&gt;</span>
<span class='lineno'>18</span>             <span class='nt'>&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;{$t/item/@icon}&quot;</span> <span class='na'>class=</span><span class='s'>&quot;micon&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>19</span>         <span class='nt'>&lt;/div&gt;</span>
<span class='lineno'>20</span>         <span class='nt'>&lt;div&gt;</span>
<span class='lineno'>21</span>             <span class='nt'>&lt;h3&gt;</span>
<span class='lineno'>22</span>                <span class='k'>&lt;xsl:value-of</span> <span class='na'>select=</span><span class='s'>&quot;$globalConfig/backTileTitle&quot;</span> <span class='nt'>/&gt;</span>
<span class='lineno'>23</span>             <span class='nt'>&lt;/h3&gt;</span>
<span class='lineno'>24</span>             <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;prettyDate&quot;</span> <span class='na'>title=</span><span class='s'>&quot;{$t/prettyDate}&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>25</span>                 <span class='k'>&lt;xsl:value-of</span> <span class='na'>select=</span><span class='s'>&quot;$t/prettyDate&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>26</span>             <span class='nt'>&lt;/span&gt;</span>
<span class='lineno'>27</span>         <span class='nt'>&lt;/div&gt;</span>
<span class='lineno'>28</span>     <span class='nt'>&lt;/div&gt;</span>
<span class='lineno'>29</span> <span class='k'>&lt;/xsl:template&gt;</span>
</code></pre>
</div>
<p>The last template builds a mashup based on the current item&#8217;s <code>$tilesConfig</code>. Think of it as multiple tables that are joined by some common keys e.g. <code> $tilesConfig/item[@BaseTemplate = $baseTemplate]</code>. Here we use the <code>@__spBaseTemplate</code> attribute of the current Row, which was passed in as <code>baseTemplate</code> param as the join criteria for <code>$tilesConfig/item/@BaseTemplate</code>. If there&#8217;s a match we make a copy of the matched <code>$tilesConfig/item</code> if not we copy <code>$tilesConfig/item[@BaseTemplate = &#39;unknown&#39;]</code> instead.</p>

<p>Everything that needs to be calculated like <code>&lt;size&gt;</code> and <code>&lt;prettyDate&gt;</code> goes in this template as well. If the logic for a given calculation would become to complex you should factor it out of course.</p>
<div class='highlight'><pre><code class='xslt'><span class='lineno'> 1</span> <span class='k'>&lt;xsl:template</span> <span class='na'>name=</span><span class='s'>&quot;MetaData&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 2</span>     <span class='k'>&lt;xsl:param</span> <span class='na'>name=</span><span class='s'>&quot;spID&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 3</span>     <span class='k'>&lt;xsl:param</span> <span class='na'>name=</span><span class='s'>&quot;baseTemplate&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 4</span>     <span class='k'>&lt;xsl:param</span> <span class='na'>name=</span><span class='s'>&quot;spPropertiesXml&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 5</span>     <span class='c'>&lt;!-- accessible via $t/item/@XXXX. Available attributes see $configMap/tiles/item/@XXXX --&gt;</span>
<span class='lineno'> 6</span>     <span class='k'>&lt;xsl:choose</span><span class='nt'>&gt;</span>
<span class='lineno'> 7</span>         <span class='k'>&lt;xsl:when</span> <span class='na'>test=</span><span class='s'>&quot;$tilesConfig/item[@BaseTemplate = $baseTemplate]&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'> 8</span>             <span class='k'>&lt;xsl:copy-of</span> <span class='na'>select=</span><span class='s'>&quot;$tilesConfig/item[@BaseTemplate = $baseTemplate]&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'> 9</span>         <span class='k'>&lt;/xsl:when&gt;</span>
<span class='lineno'>10</span>         <span class='k'>&lt;xsl:otherwise</span><span class='nt'>&gt;</span>
<span class='lineno'>11</span>             <span class='k'>&lt;xsl:copy-of</span> <span class='na'>select=</span><span class='s'>&quot;$tilesConfig/item[@BaseTemplate = &#39;unknown&#39;]&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>12</span>         <span class='k'>&lt;/xsl:otherwise&gt;</span>
<span class='lineno'>13</span>     <span class='k'>&lt;/xsl:choose&gt;</span>
<span class='lineno'>14</span>     <span class='c'>&lt;!-- accessible via $t/size --&gt;</span>
<span class='lineno'>15</span>     <span class='nt'>&lt;size&gt;</span>
<span class='lineno'>16</span>         <span class='k'>&lt;xsl:choose</span><span class='nt'>&gt;</span>
<span class='lineno'>17</span>             <span class='k'>&lt;xsl:when</span> <span class='na'>test=</span><span class='s'>&quot;msxsl:node-set($itemsInList)/item[@id = $spID]/@pos &amp;lt;= $globalConfig/wideTiles&quot;</span><span class='nt'>&gt;</span>
<span class='lineno'>18</span>                 <span class='k'>&lt;xsl:text</span><span class='nt'>&gt;</span>wide<span class='k'>&lt;/xsl:text&gt;</span>
<span class='lineno'>19</span>             <span class='k'>&lt;/xsl:when&gt;</span>
<span class='lineno'>20</span>             <span class='k'>&lt;xsl:otherwise</span><span class='nt'>/&gt;</span>
<span class='lineno'>21</span>         <span class='k'>&lt;/xsl:choose&gt;</span>
<span class='lineno'>22</span>     <span class='nt'>&lt;/size&gt;</span>
<span class='lineno'>23</span>     <span class='nt'>&lt;prettyDate&gt;</span>
<span class='lineno'>24</span>         <span class='k'>&lt;xsl:variable</span> <span class='na'>name=</span><span class='s'>&quot;DateRaw&quot;</span>
<span class='lineno'>25</span>                       <span class='na'>select=</span><span class='s'>&quot;translate(substring-before(substring-after($spPropertiesXml, &#39;Modified=&amp;quot;&#39;), &#39;&amp;quot; LastDeleted&#39;), &#39; &#39;, &#39;T&#39;)&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>26</span>         <span class='k'>&lt;xsl:value-of</span>
<span class='lineno'>27</span>                 <span class='na'>select=</span><span class='s'>&quot;concat(substring($DateRaw, 1, 4), &#39;-&#39;, substring($DateRaw, 5, 2), &#39;-&#39;, substring($DateRaw, 7,2), substring($DateRaw, 9), &#39;Z&#39;)&quot;</span><span class='nt'>/&gt;</span>
<span class='lineno'>28</span>     <span class='nt'>&lt;/prettyDate&gt;</span>
<span class='lineno'>29</span> <span class='k'>&lt;/xsl:template&gt;</span>
</code></pre>
</div>
<p>That&#8217;s it, you made it. You&#8217;ve seen how to build a modern HTML5/CSS3/JavaScript solution in SharePoint 2007/2010/(2013?) using the good old <strong>DVWP</strong>. And you know that at its core it&#8217;s powered by <strong>134 lines</strong> of XSLT.</p>

<p>As always feedback welcome and bye for now.</p>
					<div class="meta">
						<p class="date-publish">
							Published: 
							<date class="date-pub" title="2012-07-20T00:00:00+02:00" datetime="2012-07-20T00:00:00+02:00" pubdate>
							<span class="month"><abbr>July</abbr></span>
							<span class="day">20</span>
							<span class="year">2012</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
     
    	<li><a href="/categories.html#Good to know-ref">
    		Good to know <span>13</span>
    	</a></li>
    
  


						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
     
    	<li><a href="/tags.html#SharePoint-ref">SharePoint <span>4</span></a></li>
     
    	<li><a href="/tags.html#DVWP-ref">DVWP <span>2</span></a></li>
     
    	<li><a href="/tags.html#MetroJS-ref">MetroJS <span>1</span></a></li>
     
    	<li><a href="/tags.html#Zurb Foundation 3-ref">Zurb Foundation 3 <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="RainerAtSpirit" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/RainerAtSpirit" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'raineratspirit'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/2012/07/15/sharepoint-dvwp-from-workhorse-to-ferrari-in-7-steps" title="View SharePoint DVWP: from workhorse to Ferrari in 7 steps">&laquo; SharePoint DVWP: from workhorse to Ferrari in 7 steps</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/2012/08/01/the-ferrari-meets-jaydata" title="View The Ferrari meets JayData">The Ferrari meets JayData &raquo;</a></li>
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<!--<li class="contact"><address><span class="author fn n">Rainer Wittmann</span> - <span class="fn email">R.Wittmann@spirit.de</span></address></li>-->
						<li class="github"><a href="http://github.com/RainerAtSpirit/" rel="me">github.com/RainerAtSpirit</a></li>
						<li class="twitter"><a href="http://twitter.com/RainerAtSpirit/" rel="me">twitter.com/RainerAtSpirit</a></li>
                        <li class="rss"><a href="/atom.xml">Subscribe to RSS Feed</a></li>
						<!--<li class="rss"><a href="http://feeds.feedburner.com/">Subscribe to RSS Feed</a></li>-->
					</ul>
				</div><!-- misc -->
				<p class="licence">
					Theme: <a href="https://github.com/jekyllbootstrap/theme-the-program">the_program</a><br />
                    Based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a><br />
					Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>
				</p>

			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/2012/07/20/the-sharepoint-dvwp-in-ferrari-mode-strikes-again" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
  
  
</body>
</html>

